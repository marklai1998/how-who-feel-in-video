{"version":3,"sources":["../../function/get_duration.js"],"names":["mongoose","require","db_videos","model","fileUpload","path","fs","buff","Buffer","open","new_video","id","ext","err","fd","read","bytesRead","buffer","start","indexOf","timeScale","readUInt32BE","duration","movieLength","Math","floor","update","_id","count","console","log"],"mappings":";;AAAA,IAAMA,WAAWC,QAAQ,UAAR,CAAjB;AACA,IAAMC,YAAYF,SAASG,KAAT,CAAe,QAAf,CAAlB;;AAEA,IAAMC,aAAaH,QAAQ,oBAAR,CAAnB;AACA,IAAMI,OAAOJ,QAAQ,MAAR,CAAb;AACA,IAAMK,KAAKL,QAAQ,IAAR,CAAX;;AAEA,IAAIM,OAAO,IAAIC,MAAJ,CAAW,GAAX,CAAX;AACAF,GAAGG,IAAH,CAAQJ,OAAO,GAAP,GAAaK,UAAUC,EAAvB,GAA4B,WAA5B,GAA0CC,GAAlD,EAAuD,GAAvD,EAA4D,UAAUC,GAAV,EAAeC,EAAf,EAAmB;AAC3ER,OAAGS,IAAH,CAAQD,EAAR,EAAYP,IAAZ,EAAkB,CAAlB,EAAqB,GAArB,EAA0B,CAA1B,EAA6B,UAAUM,GAAV,EAAeG,SAAf,EAA0BC,MAA1B,EAAkC;AAC3D,YAAIC,QAAQD,OAAOE,OAAP,CAAe,IAAIX,MAAJ,CAAW,MAAX,CAAf,IAAqC,EAAjD;AACA,YAAIY,YAAYH,OAAOI,YAAP,CAAoBH,KAApB,EAA2B,CAA3B,CAAhB;AACA,YAAII,WAAWL,OAAOI,YAAP,CAAoBH,QAAQ,CAA5B,EAA+B,CAA/B,CAAf;AACA,YAAIK,cAAcC,KAAKC,KAAL,CAAWH,WAAWF,SAAtB,CAAlB;AACAlB,kBAAUwB,MAAV,CAAiB,EAACC,KAAKhB,EAAN,EAAjB,EAA4B;AACxBW,sBAAUC;AADc,SAA5B,EAEG,UAAUV,GAAV,EAAeH,SAAf,EAA0BkB,KAA1B,EAAiC;AAChCC,oBAAQC,GAAR,CAAY,iBAAiBV,SAA7B;AACAS,oBAAQC,GAAR,CAAY,eAAeR,QAA3B;AACAO,oBAAQC,GAAR,CAAY,mBAAmBP,WAAnB,GAAiC,UAA7C;AACH,SAND;AAOH,KAZD;AAaH,CAdD","file":"get_duration.js","sourcesContent":["const mongoose = require('mongoose');\r\nconst db_videos = mongoose.model('videos');\r\n\r\nconst fileUpload = require('express-fileupload');\r\nconst path = require('path');\r\nconst fs = require('fs');\r\n\r\nlet buff = new Buffer(100);\r\nfs.open(path + '/' + new_video.id + '_original' + ext, 'r', function (err, fd) {\r\n    fs.read(fd, buff, 0, 100, 0, function (err, bytesRead, buffer) {\r\n        let start = buffer.indexOf(new Buffer('mvhd')) + 17;\r\n        let timeScale = buffer.readUInt32BE(start, 4);\r\n        let duration = buffer.readUInt32BE(start + 4, 4);\r\n        let movieLength = Math.floor(duration / timeScale);\r\n        db_videos.update({_id: id}, {\r\n            duration: movieLength\r\n        }, function (err, new_video, count) {\r\n            console.log('time scale: ' + timeScale);\r\n            console.log('duration: ' + duration);\r\n            console.log('movie length: ' + movieLength + ' seconds');\r\n        });\r\n    });\r\n});"]}